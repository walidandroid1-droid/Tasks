<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .camera-section {
            background: white;
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            text-align: center;
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto 20px;
            border-radius: 20px;
            overflow: hidden;
            background: #000;
            aspect-ratio: 4/3;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #canvas {
            display: none;
        }

        .captured-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 3px dashed rgba(255,255,255,0.5);
            border-radius: 20px;
            pointer-events: none;
        }

        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
            animation: scan 2s linear infinite;
            display: none;
        }

        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }

        .camera-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .upload-area {
            border: 3px dashed #ccc;
            border-radius: 20px;
            padding: 40px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #e8f0ff;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #e8f0ff;
            transform: scale(1.02);
        }

        /* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¹Ø±Ù */
        .recognition-result {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            display: none;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product-identified {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .product-image-preview {
            width: 120px;
            height: 120px;
            border-radius: 15px;
            object-fit: cover;
            border: 3px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .product-category {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .confidence-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .price-suggestion {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .price-header {
            font-size: 1.2em;
            color: #555;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .price-input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-field {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f0f0f0;
            padding: 5px;
            border-radius: 10px;
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
        }

        .qty-btn:hover {
            background: #667eea;
            color: white;
        }

        .qty-value {
            font-size: 1.3em;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        .market-price {
            background: #e8f5e9;
            border-right: 4px solid #4caf50;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .market-price-title {
            color: #2e7d32;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .similar-products {
            margin-top: 20px;
        }

        .similar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .similar-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .similar-item:hover {
            border-color: #667eea;
            transform: translateY(-3px);
        }

        .similar-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .similar-item-name {
            font-size: 0.9em;
            color: #333;
            font-weight: 500;
        }

        .similar-item-price {
            color: #27ae60;
            font-weight: bold;
            margin-top: 5px;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª */
        .shopping-list {
            background: white;
            border-radius: 25px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .list-title {
            font-size: 1.5em;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .total-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .store-section {
            margin-bottom: 25px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
        }

        .store-header {
            background: #f8f9fa;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #e0e0e0;
        }

        .store-name {
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .items-list {
            list-style: none;
            padding: 15px;
        }

        .item-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .item-card:hover {
            background: #e9ecef;
            transform: translateX(-5px);
        }

        .item-image {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid white;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .item-meta {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .item-price {
            font-size: 1.3em;
            color: #27ae60;
            font-weight: bold;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .check-btn {
            background: #e8f5e9;
            color: #4caf50;
        }

        .check-btn.checked {
            background: #4caf50;
            color: white;
        }

        .delete-btn {
            background: #ffebee;
            color: #f44336;
        }

        .progress-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .loading-spinner {
            display: none;
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .voice-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
            transition: all 0.3s;
            z-index: 1000;
        }

        .voice-btn:hover {
            transform: scale(1.1);
        }

        .voice-btn.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .product-identified {
                flex-direction: column;
                text-align: center;
            }
            
            .price-input-group {
                justify-content: center;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸ“¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
        <p>ØµÙˆÙ‘Ø± Ø£ÙŠ Ù…Ù†ØªØ¬ ÙˆØ³Ø£Ø¹Ø±ÙÙ‡ Ù„Ùƒ Ù…Ø¹ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨!</p>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
    <div class="camera-section">
        <h2 style="margin-bottom: 20px; color: #333;">ğŸ¯ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ù„Ù„Ù…Ù†ØªØ¬</h2>
        
        <div class="camera-container" id="cameraContainer">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <img id="capturedImage" class="captured-image">
            <div class="camera-overlay"></div>
            <div class="scan-line" id="scanLine"></div>
        </div>

        <div class="camera-controls">
            <button class="btn btn-primary" id="startCamera" onclick="startCamera()">
                ğŸ“· ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            </button>
            <button class="btn btn-success" id="captureBtn" onclick="captureImage()" disabled>
                ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©
            </button>
            <button class="btn btn-danger" id="retakeBtn" onclick="retakeImage()" style="display: none;">
                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚Ø§Ø·
            </button>
        </div>

        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“</div>
            <div style="font-size: 1.2em; color: #666; margin-bottom: 5px;">Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§</div>
            <div style="color: #999; font-size: 0.9em;">PNG, JPG Ø­ØªÙ‰ 5MB</div>
            <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
        </div>

        <div class="loading-spinner" id="loadingSpinner"></div>

        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¹Ø±Ù -->
        <div class="recognition-result" id="recognitionResult">
            <div class="product-identified">
                <img id="resultImage" class="product-image-preview">
                <div class="product-info">
                    <div class="product-name" id="productName">Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</div>
                    <div class="product-category" id="productCategory">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</div>
                    <span class="confidence-badge" id="confidenceBadge">Ø¯Ù‚Ø© 95%</span>
                </div>
            </div>

            <div class="price-suggestion">
                <div class="price-header">
                    ğŸ’° ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ©
                </div>
                
                <div class="price-input-group">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #666;">Ø§Ù„Ø³Ø¹Ø± (Ø¯.Øª)</label>
                        <input type="number" class="input-field" id="priceInput" step="0.001" style="width: 150px;">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #666;">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                        <div class="quantity-control">
                            <button class="qty-btn" onclick="changeQuantity(-1)">âˆ’</button>
                            <span class="qty-value" id="quantityValue">1</span>
                            <button class="qty-btn" onclick="changeQuantity(1)">+</button>
                        </div>
                    </div>

                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #666;">ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³</label>
                        <select class="input-field" id="unitSelect" style="width: 120px;">
                            <option value="piece">Ù‚Ø·Ø¹Ø©</option>
                            <option value="kg">ÙƒÙŠÙ„ÙˆØºØ±Ø§Ù…</option>
                            <option value="gram">ØºØ±Ø§Ù…</option>
                            <option value="liter">Ù„ØªØ±</option>
                            <option value="box">Ø¹Ù„Ø¨Ø©</option>
                            <option value="bottle">Ø²Ø¬Ø§Ø¬Ø©</option>
                        </select>
                    </div>
                </div>

                <div class="market-price">
                    <div class="market-price-title">ğŸ’¡ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¦Ø¯ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚:</div>
                    <div id="marketPrice">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...</div>
                    <small style="color: #666; display: block; margin-top: 5px;">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ù„</small>
                </div>
            </div>

            <div class="similar-products" id="similarProducts" style="display: none;">
                <h4 style="color: #555; margin-bottom: 10px;">ğŸ”„ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©:</h4>
                <div class="similar-grid" id="similarGrid"></div>
            </div>

            <div style="margin-top: 25px; text-align: center;">
                <button class="btn btn-success" onclick="addToList()" style="padding: 15px 40px; font-size: 1.2em;">
                    âœ… Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                </button>
            </div>
        </div>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
    <div class="shopping-list" id="shoppingList" style="display: none;">
        <div class="list-header">
            <div class="list-title">
                ğŸ›’ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
                <span id="itemsCount" style="background: #667eea; color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.7em;">0 Ø¹Ù†Ø§ØµØ±</span>
            </div>
            <div class="total-badge" id="listTotal">0.000 Ø¯.Øª</div>
        </div>

        <div id="storesContainer"></div>

        <div class="progress-section">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ³ÙˆÙ‚</span>
                <span id="progressText">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>
            <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                <span id="checkedCount">0</span> Ù…Ù† <span id="totalCount">0</span> Ù…Ù†ØªØ¬ ØªÙ… Ø´Ø±Ø§Ø¤Ù‡
            </div>
        </div>
    </div>
</div>

<button class="voice-btn" id="voiceBtn" onclick="toggleVoice()" title="Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ">
    ğŸ¤
</button>

<script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙˆÙ†Ø³ÙŠØ© Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    const productDatabase = {
        'ØªÙØ§Ø­': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 5.5, unit: 'kg', icon: 'ğŸ' },
        'Ù…ÙˆØ²': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 6.2, unit: 'kg', icon: 'ğŸŒ' },
        'Ø¨Ø±ØªÙ‚Ø§Ù„': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 4.8, unit: 'kg', icon: 'ğŸŠ' },
        'Ø¨Ø·Ø§Ø·Ø§': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 2.2, unit: 'kg', icon: 'ğŸ¥”' },
        'Ø¨ØµÙ„': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 3.5, unit: 'kg', icon: 'ğŸ§…' },
        'Ø·Ù…Ø§Ø·Ù…': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 4.2, unit: 'kg', icon: 'ğŸ…' },
        'ÙÙ„ÙÙ„': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 6.0, unit: 'kg', icon: 'ğŸŒ¶ï¸' },
        'Ø®ÙŠØ§Ø±': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 3.8, unit: 'kg', icon: 'ğŸ¥’' },
        'Ø¬Ø²Ø±': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 4.5, unit: 'kg', icon: 'ğŸ¥•' },
        'Ù„ÙŠÙ…ÙˆÙ†': { category: 'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡', price: 5.0, unit: 'kg', icon: 'ğŸ‹' },
        
        'Ù„Ø­Ù… Ø¨Ù‚Ø±ÙŠ': { category: 'Ù„Ø­ÙˆÙ…', price: 28.0, unit: 'kg', icon: 'ğŸ¥©' },
        'Ù„Ø­Ù… Ù‡Ø¨Ø±Ø©': { category: 'Ù„Ø­ÙˆÙ…', price: 32.0, unit: 'kg', icon: 'ğŸ¥©' },
        'Ø¯Ø¬Ø§Ø¬': { category: 'Ù„Ø­ÙˆÙ…', price: 12.5, unit: 'kg', icon: 'ğŸ”' },
        'ÙƒØ¨Ø¯Ø©': { category: 'Ù„Ø­ÙˆÙ…', price: 18.0, unit: 'kg', icon: 'ğŸ¥©' },
        'Ø³Ø¬Ù‚': { category: 'Ù„Ø­ÙˆÙ…', price: 22.0, unit: 'kg', icon: 'ğŸŒ­' },
        
        'Ø³Ù…Ùƒ': { category: 'Ø³Ù…Ùƒ', price: 15.0, unit: 'kg', icon: 'ğŸŸ' },
        'ØªÙˆÙ†Ø©': { category: 'Ø³Ù…Ùƒ', price: 4.5, unit: 'piece', icon: 'ğŸŸ' },
        'Ø¬Ù…Ø¨Ø±ÙŠ': { category: 'Ø³Ù…Ùƒ', price: 35.0, unit: 'kg', icon: 'ğŸ¦' },
        
        'Ø­Ù„ÙŠØ¨': { category: 'Ø£Ù„Ø¨Ø§Ù†', price: 1.8, unit: 'liter', icon: 'ğŸ¥›' },
        'Ø¬Ø¨Ù†': { category: 'Ø£Ù„Ø¨Ø§Ù†', price: 18.0, unit: 'kg', icon: 'ğŸ§€' },
        'Ø²Ø¨Ø¯Ø©': { category: 'Ø£Ù„Ø¨Ø§Ù†', price: 12.0, unit: 'kg', icon: 'ğŸ§ˆ' },
        'Ø¨ÙŠØ¶': { category: 'Ø£Ù„Ø¨Ø§Ù†', price: 0.8, unit: 'piece', icon: 'ğŸ¥š' },
        
        'Ø®Ø¨Ø²': { category: 'Ù…Ø®Ø¨ÙˆØ²Ø§Øª', price: 0.4, unit: 'piece', icon: 'ğŸ' },
        'ÙƒØ¹Ùƒ': { category: 'Ù…Ø®Ø¨ÙˆØ²Ø§Øª', price: 8.0, unit: 'kg', icon: 'ğŸ¥' },
        
        'Ø£Ø±Ø²': { category: 'Ù…ÙˆØ§Ø¯ Ø¬Ø§ÙØ©', price: 5.5, unit: 'kg', icon: 'ğŸš' },
        'Ù…ÙƒØ±ÙˆÙ†Ø©': { category: 'Ù…ÙˆØ§Ø¯ Ø¬Ø§ÙØ©', price: 2.8, unit: 'kg', icon: 'ğŸ' },
        'Ø³ÙƒØ±': { category: 'Ù…ÙˆØ§Ø¯ Ø¬Ø§ÙØ©', price: 3.2, unit: 'kg', icon: 'ğŸ¬' },
        'Ø²ÙŠØª': { category: 'Ù…ÙˆØ§Ø¯ Ø¬Ø§ÙØ©', price: 8.5, unit: 'liter', icon: 'ğŸ›¢ï¸' },
        'Ø·Ø­ÙŠÙ†': { category: 'Ù…ÙˆØ§Ø¯ Ø¬Ø§ÙØ©', price: 2.5, unit: 'kg', icon: 'ğŸŒ¾' },
        
        'Ù…Ø§Ø¡': { category: 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª', price: 0.9, unit: 'liter', icon: 'ğŸ’§' },
        'Ø¹ØµÙŠØ±': { category: 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª', price: 3.5, unit: 'liter', icon: 'ğŸ§ƒ' },
        'ÙƒÙˆÙ„Ø§': { category: 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª', price: 3.8, unit: 'liter', icon: 'ğŸ¥¤' },
        
        'ØµØ§Ø¨ÙˆÙ†': { category: 'Ù…ÙˆØ§Ø¯ ØªÙ†Ø¸ÙŠÙ', price: 4.5, unit: 'piece', icon: 'ğŸ§¼' },
        'Ø´Ø§Ù…Ø¨Ùˆ': { category: 'Ù…ÙˆØ§Ø¯ ØªÙ†Ø¸ÙŠÙ', price: 8.0, unit: 'piece', icon: 'ğŸ§´' },
        'Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†': { category: 'Ù…ÙˆØ§Ø¯ ØªÙ†Ø¸ÙŠÙ', price: 5.5, unit: 'piece', icon: 'ğŸª¥' }
    };

    let currentStream = null;
    let currentProduct = null;
    let quantity = 1;
    let shoppingItems = [];
    let isListening = false;

    // Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1920 },
                    height: { ideal: 1080 }
                } 
            });
            
            const video = document.getElementById('video');
            video.srcObject = stream;
            currentStream = stream;
            
            document.getElementById('startCamera').style.display = 'none';
            document.getElementById('captureBtn').disabled = false;
            document.getElementById('uploadArea').style.display = 'none';
            
        } catch (err) {
            alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹.');
            console.error(err);
        }
    }

    // Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©
    function captureImage() {
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const capturedImage = document.getElementById('capturedImage');
        
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        
        const imageData = canvas.toDataURL('image/jpeg');
        capturedImage.src = imageData;
        capturedImage.style.display = 'block';
        video.style.display = 'none';
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
        }
        
        document.getElementById('captureBtn').style.display = 'none';
        document.getElementById('retakeBtn').style.display = 'inline-flex';
        
        analyzeImage(imageData);
    }

    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚Ø§Ø·
    function retakeImage() {
        document.getElementById('capturedImage').style.display = 'none';
        document.getElementById('video').style.display = 'block';
        document.getElementById('captureBtn').style.display = 'inline-flex';
        document.getElementById('retakeBtn').style.display = 'none';
        document.getElementById('recognitionResult').style.display = 'none';
        startCamera();
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙˆØ¹
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const imageData = e.target.result;
            document.getElementById('capturedImage').src = imageData;
            document.getElementById('capturedImage').style.display = 'block';
            document.getElementById('video').style.display = 'none';
            document.getElementById('startCamera').style.display = 'none';
            document.getElementById('captureBtn').style.display = 'none';
            document.getElementById('retakeBtn').style.display = 'inline-flex';
            
            analyzeImage(imageData);
        };
        reader.readAsDataURL(file);
    }

    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)
    function analyzeImage(imageData) {
        document.getElementById('loadingSpinner').style.display = 'block';
        document.getElementById('scanLine').style.display = 'block';
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ - ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ù‡Ù†Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù€ API
        setTimeout(() => {
            // Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ
            const products = Object.keys(productDatabase);
            const randomProduct = products[Math.floor(Math.random() * products.length)];
            const productInfo = productDatabase[randomProduct];
            
            currentProduct = {
                name: randomProduct,
                ...productInfo,
                image: imageData
            };
            
            displayRecognitionResult();
            
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('scanLine').style.display = 'none';
        }, 2000);
    }

    // Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¹Ø±Ù
    function displayRecognitionResult() {
        document.getElementById('recognitionResult').style.display = 'block';
        document.getElementById('resultImage').src = currentProduct.image;
        document.getElementById('productName').textContent = currentProduct.name;
        document.getElementById('productCategory').textContent = currentProduct.category;
        document.getElementById('priceInput').value = currentProduct.price.toFixed(3);
        document.getElementById('unitSelect').value = currentProduct.unit;
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¦Ø¯
        document.getElementById('marketPrice').innerHTML = `
            <strong>${currentProduct.price.toFixed(3)} Ø¯.Øª</strong> Ù„Ù„Ù€ ${getUnitName(currentProduct.unit)}<br>
            <small>Ø§Ù„Ù…ØªÙˆØ³Ø· ÙÙŠ Ù…Ø­Ù„Ø§Øª Ø¨Ù†Ø²Ø±Øª</small>
        `;
        
        // Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©
        displaySimilarProducts();
        
        // Scroll Ø¥Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        document.getElementById('recognitionResult').scrollIntoView({ behavior: 'smooth' });
    }

    // Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©
    function displaySimilarProducts() {
        const similar = Object.entries(productDatabase)
            .filter(([name, info]) => info.category === currentProduct.category && name !== currentProduct.name)
            .slice(0, 4);
        
        const grid = document.getElementById('similarGrid');
        grid.innerHTML = similar.map(([name, info]) => `
            <div class="similar-item" onclick="selectSimilar('${name}')">
                <div style="font-size: 2em;">${info.icon}</div>
                <div class="similar-item-name">${name}</div>
                <div class="similar-item-price">${info.price.toFixed(3)} Ø¯.Øª</div>
            </div>
        `).join('');
        
        document.getElementById('similarProducts').style.display = similar.length > 0 ? 'block' : 'none';
    }

    // Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬ Ù…Ø´Ø§Ø¨Ù‡
    function selectSimilar(productName) {
        const info = productDatabase[productName];
        currentProduct.name = productName;
        currentProduct.price = info.price;
        currentProduct.category = info.category;
        currentProduct.unit = info.unit;
        currentProduct.icon = info.icon;
        
        document.getElementById('productName').textContent = productName;
        document.getElementById('productCategory').textContent = info.category;
        document.getElementById('priceInput').value = info.price.toFixed(3);
        document.getElementById('unitSelect').value = info.unit;
    }

    // ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©
    function changeQuantity(delta) {
        quantity = Math.max(1, quantity + delta);
        document.getElementById('quantityValue').textContent = quantity;
    }

    // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    function addToList() {
        const price = parseFloat(document.getElementById('priceInput').value) || currentProduct.price;
        const unit = document.getElementById('unitSelect').value;
        
        const item = {
            id: Date.now(),
            name: currentProduct.name,
            category: currentProduct.category,
            price: price,
            quantity: quantity,
            unit: unit,
            total: price * quantity,
            image: currentProduct.image,
            icon: currentProduct.icon || 'ğŸ“¦',
            checked: false,
            store: detectStore(currentProduct.category)
        };
        
        shoppingItems.push(item);
        updateShoppingList();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
        quantity = 1;
        document.getElementById('quantityValue').textContent = '1';
        document.getElementById('recognitionResult').style.display = 'none';
        document.getElementById('retakeBtn').click();
        
        // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
        showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${item.name} Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©!`);
    }

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
    function detectStore(category) {
        const storeMap = {
            'Ù„Ø­ÙˆÙ…': 'Ø¬Ø²Ø§Ø± Ø§Ù„Ù†Ø§Ø¨Ù„ÙŠ',
            'Ø®Ø¶Ø§Ø± ÙˆÙÙˆØ§ÙƒÙ‡': 'Ø®Ø¶Ø§Ø± Ø§Ù„Ø¬Ù…Ø¹Ø©',
            'Ø³Ù…Ùƒ': 'Ø§Ù„Ø³Ù…ÙƒØ§Ø±',
            'Ø£Ù„Ø¨Ø§Ù†': 'Ø§Ù„Ù…Ø²Ø±Ø¹Ø©',
            'Ù…Ø®Ø¨ÙˆØ²Ø§Øª': 'Ø§Ù„Ù…Ø®Ø¨Ø²Ø©',
            'Ù…ÙˆØ§Ø¯ Ø¬Ø§ÙØ©': 'Ø¹Ø²ÙŠØ²Ø© ÙˆØ§Ù„Ø¬Ù…ÙŠÙ„ÙŠ',
            'Ù…Ø´Ø±ÙˆØ¨Ø§Øª': 'Ø§Ù„Ø¹Ø§Ù…Ø©',
            'Ù…ÙˆØ§Ø¯ ØªÙ†Ø¸ÙŠÙ': 'Ø§Ù„Ø¹Ø§Ù…Ø©'
        };
        return storeMap[category] || 'Ù…ØªØ¬Ø± Ø¹Ø§Ù…';
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
    function updateShoppingList() {
        const container = document.getElementById('storesContainer');
        const listDiv = document.getElementById('shoppingList');
        
        if (shoppingItems.length === 0) {
            listDiv.style.display = 'none';
            return;
        }
        
        listDiv.style.display = 'block';
        
        // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ù„Ø§Øª
        const byStore = {};
        shoppingItems.forEach(item => {
            if (!byStore[item.store]) byStore[item.store] = [];
            byStore[item.store].push(item);
        });
        
        let html = '';
        let grandTotal = 0;
        let totalChecked = 0;
        let totalItems = shoppingItems.length;
        
        Object.entries(byStore).forEach(([store, items]) => {
            const storeTotal = items.reduce((sum, item) => sum + (item.checked ? 0 : item.total), 0);
            grandTotal += storeTotal;
            totalChecked += items.filter(i => i.checked).length;
            
            html += `
                <div class="store-section">
                    <div class="store-header">
                        <div class="store-name">
                            ${getStoreIcon(store)} ${store}
                        </div>
                        <div style="font-weight: bold; color: #667eea;">
                            ${storeTotal.toFixed(3)} Ø¯.Øª
                        </div>
                    </div>
                    <ul class="items-list">
                        ${items.map(item => `
                            <li class="item-card ${item.checked ? 'checked' : ''}">
                                <img src="${item.image}" class="item-image" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2260%22 height=%2260%22><text x=%2230%22 y=%2235%22 font-size=%2230%22 text-anchor=%22middle%22>${item.icon}</text></svg>'">
                                <div class="item-details">
                                    <div class="item-name">${item.name}</div>
                                    <div class="item-meta">
                                        ${item.quantity} ${getUnitName(item.unit)} Ã— ${item.price.toFixed(3)} Ø¯.Øª
                                    </div>
                                </div>
                                <div class="item-price">${item.total.toFixed(3)} Ø¯.Øª</div>
                                <div class="item-actions">
                                    <button class="action-btn check-btn ${item.checked ? 'checked' : ''}" onclick="toggleItem(${item.id})">
                                        ${item.checked ? 'âœ“' : 'â—‹'}
                                    </button>
                                    <button class="action-btn delete-btn" onclick="deleteItem(${item.id})">ğŸ—‘ï¸</button>
                                </div>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `;
        });
        
        container.innerHTML = html;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        document.getElementById('itemsCount').textContent = `${totalItems} Ø¹Ù†Ø§ØµØ±`;
        document.getElementById('listTotal').textContent = `${grandTotal.toFixed(3)} Ø¯.Øª`;
        document.getElementById('checkedCount').textContent = totalChecked;
        document.getElementById('totalCount').textContent = totalItems;
        
        const progress = totalItems > 0 ? (totalChecked / totalItems * 100) : 0;
        document.getElementById('progressBar').style.width = progress + '%';
        document.getElementById('progressText').textContent = progress.toFixed(0) + '%';
    }

    function getStoreIcon(store) {
        const icons = {
            'Ø¬Ø²Ø§Ø± Ø§Ù„Ù†Ø§Ø¨Ù„ÙŠ': 'ğŸ¥©',
            'Ø®Ø¶Ø§Ø± Ø§Ù„Ø¬Ù…Ø¹Ø©': 'ğŸ¥¬',
            'Ø§Ù„Ø³Ù…ÙƒØ§Ø±': 'ğŸŸ',
            'Ø§Ù„Ù…Ø²Ø±Ø¹Ø©': 'ğŸ”',
            'Ø§Ù„Ù…Ø®Ø¨Ø²Ø©': 'ğŸ¥–',
            'Ø¹Ø²ÙŠØ²Ø© ÙˆØ§Ù„Ø¬Ù…ÙŠÙ„ÙŠ': 'ğŸ¥«',
            'Ù…ØªØ¬Ø± Ø¹Ø§Ù…': 'ğŸª'
        };
        return icons[store] || 'ğŸª';
    }

    function getUnitName(unit) {
        const names = {
            'piece': 'Ù‚Ø·Ø¹Ø©',
            'kg': 'ÙƒØº',
            'gram': 'ØºØ±Ø§Ù…',
            'liter': 'Ù„ØªØ±',
            'box': 'Ø¹Ù„Ø¨Ø©',
            'bottle': 'Ø²Ø¬Ø§Ø¬Ø©'
        };
        return names[unit] || unit;
    }

    function toggleItem(id) {
        const item = shoppingItems.find(i => i.id === id);
        if (item) {
            item.checked = !item.checked;
            updateShoppingList();
        }
    }

    function deleteItem(id) {
        shoppingItems = shoppingItems.filter(i => i.id !== id);
        updateShoppingList();
    }

    function showNotification(message) {
        const div = document.createElement('div');
        div.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
        `;
        div.textContent = message;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 3000);
    }

    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ
    function toggleVoice() {
        if (!('webkitSpeechRecognition' in window)) {
            alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ');
            return;
        }
        
        const btn = document.getElementById('voiceBtn');
        
        if (isListening) {
            recognition.stop();
            isListening = false;
            btn.classList.remove('listening');
        } else {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ar-TN';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onstart = () => {
                isListening = true;
                btn.classList.add('listening');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                searchProduct(transcript);
            };
            
            recognition.onend = () => {
                isListening = false;
                btn.classList.remove('listening');
            };
            
            recognition.start();
        }
    }

    function searchProduct(query) {
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const results = Object.entries(productDatabase).filter(([name, info]) => 
            name.includes(query) || query.includes(name)
        );
        
        if (results.length > 0) {
            const [name, info] = results[0];
            currentProduct = {
                name: name,
                ...info,
                image: `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><text x="100" y="120" font-size="80" text-anchor="middle">${info.icon}</text></svg>`
            };
            displayRecognitionResult();
        } else {
            alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬: ' + query);
        }
    }

    // Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª
    const uploadArea = document.getElementById('uploadArea');
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const event = { target: { files: files } };
            handleFileSelect(event);
        }
    });
</script>

</body>
</html>
